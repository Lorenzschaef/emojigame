<!DOCTYPE HTML>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emojigame</title>
    <script type="text/javascript" src="dist.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
<div id="myapp">Connecting...</div>
</body>

<script type="text/javascript">

    // Create your WebSocket.
    var socket = new WebSocket('ws://' + window.location.host);

    socket.addEventListener('open', function() {

        // Start the Elm application.
        var app = Elm.Main.init({
            node: document.getElementById('myapp'),
            flags: window.localStorage.getItem('secret') || Math.random().toString(),
        });

        // console.log('ws connected');

        // When a command goes to the `sendMessage` port, we pass the message
        // along to the WebSocket.
        app.ports.sendMessage.subscribe(function(message) {
            socket.send(message);
        });

        // When a message comes into our WebSocket, we pass the message along
        // to the `messageReceiver` port.
        socket.addEventListener("message", function(event) {
            app.ports.messageReceiver.send(event.data);
        });

        app.ports.saveLogin.subscribe(function(args) {
            window.localStorage.setItem('room', args[0]);
            window.localStorage.setItem('player', args[1]);
        });

        socket.addEventListener("close", function(event) {
            console.log('ws closed');
            app.ports.wsDisconnectReceiver.send(null);
        });

        // app.ports.wsConnectReceiver.send(null);

    });


    // If you want to use a JavaScript library to manage your WebSocket
    // connection, replace the code in JS with the alternate implementation.
</script>

</html>